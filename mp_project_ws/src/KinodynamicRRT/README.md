# KinodynamicRRT

This project is built using ROS Melodic, Gazebo and Mapping and Planning libraries, Octomap, EDT3D and OMPL.

### Installation

#### Mapping Dependencies

      sudo apt-get install ros-$DISTRO-octomap-*  
      sudo apt-get install ros-$DISTRO-pcl-ros

      git clone https://github.com/OctoMap/octomap 
             (Octomap source code is needed to generate EDT map (DynamicEDT3D class))

      cd octomap

      mkdir build

      cd build

      cmake .. && make

      sudo make install

#### Control dependencies
* PX4-Autopilot firmware has been used to control the drone (https://github.com/PX4/PX4-Autopilot).
* Trajectory generated by the planner is traversed using offboard position control.
* Position messages (with and without yaw) is published on the topic /mavros/setpoint_local/position.
* Mavros has been used to pass the waypoints to the Pixhawk flight controller.

* Installing PX4-Autopilot
   
       Refer to https://github.com/PX4/PX4-Autopilot for setting up PX4 for simulation

* Installing Mavros
    
      sudo apt-get install ros-$DISTRO-mavros ros-$DISTRO-mavros-extras

      wget https://raw.githubusercontent.com/mavlink/mavros/master/mavros/scripts/install_geographiclib_datasets.sh

      sudo bash ./install_geographiclib_datasets.sh   

#### Planning Dependencies
We are using `ros-melodic-ompl: 1.4.2-5bionic` for this project.

* Path planning is done using Kinodynamic RRT using OMPL taking into account the dynamics of the drone in 2D and 3D environments.
* The drone is assumed to take into account the nodes only in its visible region and prune all other nodes in the predicted path which are outside its visible region.
* The start location of the drone is modified to point to the new start which is located at the end of the visible region.
* Octomap is integrated to visualize the environment and EDT3D library perofrms the collision check within the visible region of the drone.


### Running the Planner
* Simulation

        Terminal-1 : cd PX4-Autpilot && source Tools/simulation/gazebo-classic/setup_gazebo.bash $(pwd) $(pwd)/build/px4_sitl_default && roslaunch gazebo_ros empty_world.launch

        Terminal-2 : cd mp_ws && roslaunch KinodynamicRRT MappingSim.launch

        Terminal-3 : cd mp_ws && roslaunch octomap_server octomap_server_node motion_planning_5.bt

        Terminal-4 : cd PX4-Autopilot make px4_sitl gazebo-classic_iris_depth_camera

        Terminal-5 : rosrun KinodynamicRRT drone3D /home/shreyas/mp_ws/motion_planning_5.bt

